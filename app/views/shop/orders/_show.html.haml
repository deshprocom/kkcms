%div.shop-order-detail
  %div.header
    %div
      %span{ class: 'count_down', data:{ status: resource.status, timestamp: resource.created_at.to_i } }
        = "订单状态： #{I18n.t('order.' + resource.status)}"
        %span.multi-status
          - if resource.paid?
            %span= link_to '发货', new_shop_order_shipment_path(resource), remote: true
          - if resource.delivered?
            -#%span= link_to '查看物流', shipping_detail_shop_product_order_path(resource), remote: true
            %span= link_to '修改物流信息', edit_shop_order_shipment_path(resource, resource.shipment), remote: true
          - if resource.completed?
            -#%span= link_to '查看物流', shipping_detail_shop_product_order_path(resource), remote: true
          - if resource.unpaid?
            %span.cancel= link_to '取消', cancel_shop_order_path(resource), remote: true
    %div
      %span="物流信息: #{resource.shipment.express.name}( #{resource.shipment.express_number} )" if resource.shipment
  %div.body
    %div.content
      %div
        %span= "订单编号：#{resource.order_number}"
        %span= "下单时间：#{resource.created_at}"
      %div
        %table
          %tr
            %td 序号
            %td 商品名称
            %td 商品图片
            %td 类别
            %td 价格
            %td 实付价格
            %td 数量
          - resource.order_items.each_with_index do |item, index|
          %tr
          - variant = item.variant
          - product = item.product
            %td= index + 1
            %td
              %p= product.title
              %p.text_sku= item.sku_value.join(', ')
            %td
              - img = variant&.image&.preview || product.preview_icon
              = link_to image_tag(img, height: 200), target: '_blank'
            %td= product.category&.name
            %td= item.original_price
            %td= item.price
            %td= item.number
        %span= "总价：¥#{resource.total_price}，实付：¥#{resource.final_price} (快递：¥#{resource.shipping_price})"
    - user = resource.user
    %div.user_info
      %div
        %div 用户账户信息
        %div
          %span= "用户id：#{user.user_uuid}"
          %span= "用户手机：#{user.mobile}"
          %span= "用户邮箱：#{user.email}"
      - address = resource.shipping_info
      %div
        %div 收货地址信息
        %div
          %span= "收货人：#{address.name}"
          %span= "联系方式：#{address.mobile}"
          %span= "收货地址：#{address.full_address}"
        %div
          %span= "用户备注：#{address.memo}"
